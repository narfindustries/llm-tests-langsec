module HL7_v2;

export {
    type HL7Message = unit {
        segments: [HL7Segment] &until(eod());
    };

    type HL7Segment = unit {
        id: string &length=3;
        data: bytes &until(eol);
    };

    const eol = /\r\n|\n|\r/;
}

public type HL7_v2_Protocol = unit {
    message: HL7Message;
} &parsers = [
    spicy::Parser(
        name="hl7-v2",
        ports=9937/tcp,
        protocol=spicy::Transport::TCP
    )
];