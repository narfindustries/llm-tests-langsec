module DICOM;

import spicy;

public type File = unit {
    magic: bytes &size=128 &convert="DICM";
    header: Header;
    data: bytes &until=b"\x00\x00\x00\x00";
};

type Header = unit {
    preamble: bytes &size=128;
    prefix: bytes &size=4 &convert="DICM";
    elements: Element[];
};

type Element = unit {
    group: uint16;
    element: uint16;
    vr: bytes &size=2;
    length: uint16;
    value: bytes &size=length;
};

on File::%init {
    print "DICOM file parsed successfully!";
}