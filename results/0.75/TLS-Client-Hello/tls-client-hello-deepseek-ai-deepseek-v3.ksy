meta:
  id: tls_client_hello
  title: TLS Client Hello
  application: TLS
  license: MIT
  endian: be
seq:
  - id: legacy_version
    type: u2
    doc: The highest supported version of TLS that the client supports, set to 0x0303 (TLS 1.2) for backward compatibility.
  - id: random
    size: 32
    doc: A 32-byte value consisting of 4 bytes Unix timestamp and 28 bytes randomly generated bytes.
  - id: legacy_session_id
    type: session_id
    doc: Session ID from a previous session for resumption.
  - id: cipher_suites
    type: cipher_suites
    doc: A list of cipher suites supported by the client, ordered by preference.
  - id: legacy_compression_methods
    type: compression_methods
    doc: A list of compression methods supported by the client. In TLS 1.3, this is typically set to a single null byte (0x00).
  - id: extensions
    type: extensions
    doc: A list of extensions that provide additional functionality or negotiation parameters.
types:
  session_id:
    seq:
      - id: length
        type: u1
      - id: session_id
        size: length
  cipher_suites:
    seq:
      - id: length
        type: u2
      - id: cipher_suites
        type: u2
        repeat: expr
        repeat-expr: (length / 2)
  compression_methods:
    seq:
      - id: length
        type: u1
      - id: compression_methods
        type: u1
        repeat: expr
        repeat-expr: length
  extensions:
    seq:
      - id: length
        type: u2
      - id: extensions
        type: extension
        repeat: until
        repeat-until: _.is_end
  extension:
    seq:
      - id: extension_type
        type: u2
      - id: extension_data_length
        type: u2
      - id: extension_data
        size: extension_data_length
    instances:
      is_end:
        value: _io.pos >= _io.size