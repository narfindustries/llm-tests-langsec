module ZIP;

public type File = unit {
    signature: bytes &size=4;
    version: uint16;
    flags: uint16;
    compression_method: uint16;
    last_mod_time: uint16;
    last_mod_date: uint16;
    crc32: uint32;
    compressed_size: uint32;
    uncompressed_size: uint32;
    filename_length: uint16;
    extra_field_length: uint16;

    filename: bytes &size=filename_length;
    extra_field: bytes &size=extra_field_length;

    data: bytes &size=compressed_size;

    on %init {
        self.verify_signature();
    }

    function verify_signature() {
        if ( self.signature != b"PK\x03\x04" ) {
            throw "Invalid ZIP file signature";
        }
    }
};

public type Parser = unit {
    files: File[];
};