module NITF;

import spicy;

public type Header = unit {
    magic: bytes &size=4;
    version: uint8;
    flags: uint8;
    length: uint32;
};

public type ImageSegment = unit {
    header: Header;
    data: bytes &size=length;
};

public type NITF = unit {
    header: Header;
    segments: ImageSegment[] &until($input.size() == 0);
};

on NITF::header {
    print "NITF Header:";
    print "  Magic: %s" % self.magic;
    print "  Version: %d" % self.version;
    print "  Flags: %d" % self.flags;
    print "  Length: %d" % self.length;
}

on NITF::segments {
    print "Image Segment:";
    print "  Header:";
    print "    Magic: %s" % self.header.magic;
    print "    Version: %d" % self.header.version;
    print "    Flags: %d" % self.header.flags;
    print "    Length: %d" % self.header.length;
    print "  Data: %s" % self.data;
}