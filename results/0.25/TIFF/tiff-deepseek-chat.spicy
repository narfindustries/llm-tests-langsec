module TIFF;

import spicy;

public type TIFF_Header = unit {
    magic: bytes &size=2;
    version: uint16;
    offset: uint32;
};

public type IFD_Entry = unit {
    tag: uint16;
    type: uint16;
    count: uint32;
    value: uint32;
};

public type IFD = unit {
    num_entries: uint16;
    entries: IFD_Entry[] &size=num_entries;
    next_ifd: uint32;
};

public type TIFF_File = unit {
    header: TIFF_Header;
    ifds: IFD[] &until($$.next_ifd == 0);
};

on TIFF_File::%done {
    print "TIFF file parsed successfully";
}