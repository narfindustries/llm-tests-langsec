meta:
  id: tls_client_hello
  title: TLS Client Hello Message
  application: TLS Protocol
  xref:
    rfc: 8446
seq:
  - id: legacy_version
    type: u2
    doc: The TLS version, fixed at 0x0303 for compatibility.
  - id: random
    size: 32
    doc: Random bytes generated by the client.
  - id: legacy_session_id_length
    type: u1
    doc: Length of the session ID.
  - id: legacy_session_id
    size: legacy_session_id_length
    doc: Session ID for session resumption.
  - id: cipher_suites_length
    type: u2
    doc: Length of the cipher suites list.
  - id: cipher_suites
    type: cipher_suite
    repeat: expr
    repeat-expr: cipher_suites_length / 2
    doc: List of cipher suites supported by the client.
  - id: legacy_compression_methods_length
    type: u1
    doc: Length of the compression methods list, typically 1.
  - id: legacy_compression_methods
    size: legacy_compression_methods_length
    doc: Compression methods (should be 0 for TLS 1.3).
  - id: extensions_length
    type: u2
    doc: Length of the extensions list.
  - id: extensions
    type: tls_extension
    repeat: expr
    repeat-expr: extensions_length
    doc: Extensions providing additional capabilities.
types:
  cipher_suite:
    seq:
      - id: suite
        type: u2
        enum: cipher_suites_enum
        doc: Enumerated cipher suite.
  tls_extension:
    seq:
      - id: type
        type: u2
        enum: extension_type
        doc: Type of the extension.
      - id: length
        type: u2
        doc: Length of the extension data.
      - id: data
        size: length
        type:
          switch-on: type
          cases:
            'extension_type::server_name': server_name
            'extension_type::supported_versions': supported_versions
            'extension_type::signature_algorithms': signature_algorithms
            'extension_type::supported_groups': supported_groups
            'extension_type::key_share': key_share
            'extension_type::psk_key_exchange_modes': psk_key_exchange_modes
            'extension_type::early_data': early_data
enums:
  cipher_suites_enum:
    0x1301: TLS_AES_128_GCM_SHA256
    0x1302: TLS_AES_256_GCM_SHA384
    0x1303: TLS_CHACHA20_POLY1305_SHA256
  extension_type:
    0x0000: server_name
    0x0001: max_fragment_length
    0x0002: status_request
    0x0003: supported_groups
    0x0004: signature_algorithms
    0x0005: use_srtp
    0x0006: heartbeat
    0x0007: application_layer_protocol_negotiation
    0x0008: signed_certificate_timestamp
    0x0009: client_certificate_type
    0x000A: server_certificate_type
    0x000B: padding
    0x000C: pre_shared_key
    0x000D: early_data
    0x000E: supported_versions
    0x000F: cookie
    0x0010: psk_key_exchange_modes
    0x0011: certificate_authorities
    0x0012: oid_filters
    0x0013: post_handshake_auth
    0x0014: signature_algorithms_cert
    0x0015: key_share
types:
  server_name:
    seq:
      - id: list_length
        type: u2
      - id: server_name_list
        type: server_name_type
        repeat: expr
        repeat-expr: list_length
  server_name_type:
    seq:
      - id: name_type
        type: u1
      - id: length
        type: u2
      - id: name
        size: length
  supported_versions:
    seq:
      - id: versions_length
        type: u1
      - id: versions
        type: u2
        repeat: expr
        repeat-expr: versions_length / 2
  signature_algorithms:
    seq:
      - id: algorithms_length
        type: u2
      - id: algorithms
        type: u2
        repeat: expr
        repeat-expr: algorithms_length / 2
  supported_groups:
    seq:
      - id: groups_length
        type: u2
      - id: groups
        type: u2
        repeat: expr
        repeat-expr: groups_length / 2
  key_share:
    seq:
      - id: shares_length
        type: u2
      - id: shares
        type: key_share_entry
        repeat: expr
        repeat-expr: shares_length
  key_share_entry:
    seq:
      - id: group
        type: u2
      - id: key_exchange_length
        type: u2
      - id: key_exchange
        size: key_exchange_length
  psk_key_exchange_modes:
    seq:
      - id: modes_length
        type: u1
      - id: modes
        type: u1
        repeat: expr
        repeat-expr: modes_length
  early_data:
    seq:
      - id: max_early_data_size
        type: u4
        doc: Maximum size of early data the client is willing to send.