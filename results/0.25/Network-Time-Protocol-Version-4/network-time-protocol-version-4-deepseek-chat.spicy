module Network_Time_Protocol_Version_4;

export {
    type NTP_Packet = unit {
        leap_indicator: uint8 &convert=static_cast<LeapIndicator>(self);
        version: uint8 &mask=0x38 &convert=static_cast<Version>(self >> 3);
        mode: uint8 &mask=0x07 &convert=static_cast<Mode>(self);
        stratum: uint8;
        poll: uint8;
        precision: uint8;
        root_delay: uint32;
        root_dispersion: uint32;
        reference_id: uint32;
        reference_timestamp: uint64;
        originate_timestamp: uint64;
        receive_timestamp: uint64;
        transmit_timestamp: uint64;
    };

    type LeapIndicator = enum {
        NO_WARNING = 0,
        LAST_MINUTE_61 = 1,
        LAST_MINUTE_59 = 2,
        ALARM_CONDITION = 3,
    };

    type Version = enum {
        V3 = 3,
        V4 = 4,
    };

    type Mode = enum {
        RESERVED = 0,
        SYMMETRIC_ACTIVE = 1,
        SYMMETRIC_PASSIVE = 2,
        CLIENT = 3,
        SERVER = 4,
        BROADCAST = 5,
        CONTROL_MESSAGE = 6,
        PRIVATE_USE = 7,
    };
}

on NTP_Packet::%done {
    print self;
}