<?xml version="1.0" encoding="UTF-8"?>
<xs:schema xmlns:xs="http://www.w3.org/2001/XMLSchema"
           xmlns:dfdl="http://www.ogf.org/dfdl/dfdl-1.0/"
           targetNamespace="http://example.com/sqlite3"
           xmlns:tns="http://example.com/sqlite3"
           elementFormDefault="qualified"
           attributeFormDefault="unqualified">

  <xs:annotation>
    <xs:appinfo source="http://www.ogf.org/dfdl/">
      <dfdl:format ref="tns:sqlite3Format"/>
    </xs:appinfo>
  </xs:annotation>

  <dfdl:format name="sqlite3Format"
               byteOrder="bigEndian"
               encoding="utf-8"
               lengthKind="explicit"
               lengthUnits="bytes"
               alignmentUnits="bytes"
               occursCountKind="expression"
               occursCount="{ ../numRecords }"/>

  <xs:element name="sqlite3Database">
    <xs:complexType>
      <xs:sequence>
        <xs:element name="header" type="tns:headerType"/>
        <xs:element name="page" type="tns:pageType" maxOccurs="unbounded"/>
      </xs:sequence>
    </xs:complexType>
  </xs:element>

  <xs:complexType name="headerType">
    <xs:sequence>
      <xs:element name="magic" type="xs:string" dfdl:length="16" dfdl:lengthUnits="bytes"/>
      <xs:element name="pageSize" type="xs:unsignedShort"/>
      <xs:element name="fileFormatWriteVersion" type="xs:unsignedByte"/>
      <xs:element name="fileFormatReadVersion" type="xs:unsignedByte"/>
      <xs:element name="reservedSpace" type="xs:unsignedByte"/>
      <xs:element name="maxEmbeddedPayloadFraction" type="xs:unsignedByte"/>
      <xs:element name="minEmbeddedPayloadFraction" type="xs:unsignedByte"/>
      <xs:element name="leafPayloadFraction" type="xs:unsignedByte"/>
      <xs:element name="fileChangeCounter" type="xs:unsignedInt"/>
      <xs:element name="numPages" type="xs:unsignedInt"/>
      <xs:element name="firstFreelistTrunkPage" type="xs:unsignedInt"/>
      <xs:element name="numFreelistPages" type="xs:unsignedInt"/>
      <xs:element name="schemaCookie" type="xs:unsignedInt"/>
      <xs:element name="schemaFormatNumber" type="xs:unsignedInt"/>
      <xs:element name="defaultPageCacheSize" type="xs:unsignedInt"/>
      <xs:element name="largestRootBtreePage" type="xs:unsignedInt"/>
      <xs:element name="textEncoding" type="xs:unsignedInt"/>
      <xs:element name="userVersion" type="xs:unsignedInt"/>
      <xs:element name="incrementalVacuumMode" type="xs:unsignedInt"/>
      <xs:element name="applicationId" type="xs:unsignedInt"/>
      <xs:element name="reserved" type="xs:hexBinary" dfdl:length="20" dfdl:lengthUnits="bytes"/>
      <xs:element name="versionValidFor" type="xs:unsignedInt"/>
      <xs:element name="sqliteVersionNumber" type="xs:unsignedInt"/>
    </xs:sequence>
  </xs:complexType>

  <xs:complexType name="pageType">
    <xs:sequence>
      <xs:element name="pageHeader" type="tns:pageHeaderType"/>
      <xs:element name="cellContent" type="xs:hexBinary" dfdl:length="{ ../header/pageSize - 100 }" dfdl:lengthUnits="bytes"/>
    </xs:sequence>
  </xs:complexType>

  <xs:complexType name="pageHeaderType">
    <xs:sequence>
      <xs:element name="pageType" type="xs:unsignedByte"/>
      <xs:element name="firstFreeblock" type="xs:unsignedShort"/>
      <xs:element name="numCells" type="xs:unsignedShort"/>
      <xs:element name="cellContentArea" type="xs:unsignedShort"/>
      <xs:element name="numFragmentedFreeBytes" type="xs:unsignedByte"/>
    </xs:sequence>
  </xs:complexType>

</xs:schema>