module GZIP;

public type GzipFile = unit {
    magic: uint16;
    compression_method: uint8;
    flags: uint8;
    mtime: uint32;
    extra_flags: uint8;
    os: uint8;
    : bstring &requires=($context.flags & 0x04) != 0 {
        xlen: uint16;
        extra: bytes &size=xlen;
    }
    : bstring &requires=($context.flags & 0x08) != 0 {
        filename: bytes &until=b"\x00";
    }
    : bstring &requires=($context.flags & 0x10) != 0 {
        comment: bytes &until=b"\x00";
    }
    : bstring &requires=($context.flags & 0x02) != 0 {
        header_crc: uint16;
    }
    compressed_data: bytes &size=(self.size - $$ - 8);
    crc32: uint32;
    isize: uint32;

    on %init {
        print "Gzip file parsing started";
    }

    on %done {
        print "Gzip file parsing completed";
    }
};