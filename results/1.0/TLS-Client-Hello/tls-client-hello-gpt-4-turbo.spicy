module TLS;

import spicy;

public type ClientHello = unit {
    version: Version;
    random: bytes &size=32;
    session_id_len: uint8;
    session_id: bytes &size=uint(session_id_len);
    cipher_suites_len: uint16;
    cipher_suites: CipherSuites &size=cipher_suites_len;
    compression_methods_len: uint8;
    compression_methods: bytes &size=compression_methods_len;
    extensions_len: uint16 &optional;
    extensions: ExtensionList &size=extensions_len;

    on %done {
        print self;
    }
};

type Version = unit {
    major: uint8;
    minor: uint8;
};

type CipherSuites = unit {
    suite_list: CipherSuite[] &eod;
};

type CipherSuite = unit {
    suite: uint16;
};

type ExtensionList = unit {
    list: Extension[] &eod;
};

type Extension = unit {
    type: bytes &size=2;
    length: uint16;
    data: bytes &size=length;
};