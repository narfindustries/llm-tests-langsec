module SQLITE3;

import spicy;

public type SQLite3DatabaseHeader = unit {
    magic_number: bytes(4) &requires=($$ == b"SQLi");
    page_size: uint16 be;
    write_version: uint8;
    read_version: uint8;
    reserved_space: uint8;
    max_payload_fraction: uint8;
    min_payload_fraction: uint8;
    leaf_payload_fraction: uint8;
    file_change_counter: uint32 be;
    page_count: uint32 be;
    freelist_trunk_page: uint32 be;
    freelist_page_count: uint32 be;
    schema_cookie: uint32 be;
    schema_format: uint32 be;
    default_cache_size: uint32 be;
    largest_root_page: uint32 be;
    text_encoding: uint32 be;
    user_version: uint32 be;
    
    :/\x00{16}/; // 16-byte reserved section
    
    on %done {
        print "SQLite3 Database Header Parsed";
    }
}

public type SQLite3 = unit {
    header: SQLite3DatabaseHeader;
    
    on %done {
        print "Complete SQLite3 Database Parsed";
    }
}