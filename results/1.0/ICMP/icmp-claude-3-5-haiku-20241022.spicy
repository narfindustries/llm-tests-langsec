module ICMP;

import spicy;

public type Message = unit {
    type_code: bitfield(8) {
        type:     0..7;
        code:    8..15;
    };

    header: Header;
    payload: bytes &size=(|self.header.total_length| - 8);

    on type_code {
        self.type_code.type = $$.type;
        self.type_code.code = $$.code;
    }

    type Header = unit {
        type:           uint8;
        code:           uint8;
        checksum:       uint16;
        total_length:   uint16 &convert=(8 + |payload|);
    };

    on Hello: bool = False;
};