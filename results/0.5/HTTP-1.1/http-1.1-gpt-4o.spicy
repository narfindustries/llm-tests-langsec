module HTTP;

public type Request = unit {
    method: string &restofdata;
    uri: string &restofdata;
    version: string &restofdata;
    headers: Headers;
    body: bytes &restofdata;
} &byte-order=network;

public type Headers = unit {
    headers: repeat (Header) &until=|eos|;
};

public type Header = unit {
    name: string &restofdata;
    value: string &restofdata;
} &byte-order=network;

public type Response = unit {
    version: string &restofdata;
    status_code: uint16 &restofdata;
    reason_phrase: string &restofdata;
    headers: Headers;
    body: bytes &restofdata;
} &byte-order=network;

public module Parser {
    public function parse_request(data: bytes) : Request {
        return parse(Request, data);
    }

    public function parse_response(data: bytes) : Response {
        return parse(Response, data);
    }
}