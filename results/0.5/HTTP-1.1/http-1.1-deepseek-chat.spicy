module HTTP_1_1;

import spicy;

public type Request = unit {
    method: bytes &size=8;
    path: bytes &size=256;
    version: bytes &size=8;
    headers: Header[] &until=($ == b"\r\n\r\n");
    body: bytes &size=1024;
};

public type Header = unit {
    name: bytes &size=64;
    value: bytes &size=256;
};

public type Response = unit {
    version: bytes &size=8;
    status: bytes &size=8;
    message: bytes &size=256;
    headers: Header[] &until=($ == b"\r\n\r\n");
    body: bytes &size=1024;
};

on HTTP_1_1::Request::%done {
    print self.method, self.path, self.version;
    for (h in self.headers)
        print h.name, h.value;
    print self.body;
}

on HTTP_1_1::Response::%done {
    print self.version, self.status, self.message;
    for (h in self.headers)
        print h.name, h.value;
    print self.body;
}