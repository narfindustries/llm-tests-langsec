module HL7_v2;

import spicy;

type HL7_Message = unit {
    segments: Segment[] &until($input.eod());
};

type Segment = unit {
    id: bytes &size=3;
    fields: Field[] &until($input.eod());
};

type Field = unit {
    components: Component[] &until($input.eod());
};

type Component = unit {
    subcomponents: Subcomponent[] &until($input.eod());
};

type Subcomponent = unit {
    value: bytes &until($input.eod());
};

on HL7_Message::%done {
    # Custom logic to handle the parsed HL7 message
    print "Parsed HL7 message";
}