module ICMP;

import spicy;

public type ICMP_Header = unit {
    type: uint8;
    code: uint8;
    checksum: uint16;
    rest_of_header: bytes &size=4;
};

public type ICMP_Echo = unit {
    identifier: uint16;
    sequence: uint16;
    data: bytes &until=b"\x00";
};

public type ICMP_Packet = unit {
    header: ICMP_Header;
    echo: ICMP_Echo if header.type == 8 || header.type == 0;
};

on ICMP_Packet::%done {
    print self;
}