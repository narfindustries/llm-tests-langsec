module Modbus;

import spicy;

export type Modbus_Header = unit {
    transaction_id: uint16;
    protocol_id: uint16;
    length: uint16;
    unit_id: uint8;
};

export type Modbus_PDU = unit {
    function_code: uint8;
    data: bytes &size=length-2;
};

export type Modbus_Message = unit {
    header: Modbus_Header;
    pdu: Modbus_PDU &length=header.length-1;
};

on Modbus_Message::%done {
    print "Modbus message parsed successfully";
}