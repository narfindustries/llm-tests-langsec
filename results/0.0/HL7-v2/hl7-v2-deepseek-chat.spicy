module HL7_v2;

import spicy;

type HL7_Message = unit {
    segment: Segment[];
};

type Segment = unit {
    fields: Field[];
    separator: /\\x0D/;
};

type Field = unit {
    components: Component[];
    separator: /\\x7C/;
};

type Component = unit {
    subcomponents: Subcomponent[];
    separator: /\\x5E/;
};

type Subcomponent = unit {
    data: /[^\\x7C\\x5E\\x0D]*/;
};

on HL7_Message::%init {
    print "Parsing HL7 v2 message";
}

on Segment::%init {
    print "Parsing segment";
}

on Field::%init {
    print "Parsing field";
}

on Component::%init {
    print "Parsing component";
}

on Subcomponent::%init {
    print "Parsing subcomponent";
}