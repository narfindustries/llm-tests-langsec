module ZIP;

import spicy;

public type LocalFileHeader = unit {
    signature: bytes &size=4;
    versionNeeded: uint16;
    flags: uint16;
    compressionMethod: uint16;
    lastModFileTime: uint16;
    lastModFileDate: uint16;
    crc32: uint32;
    compressedSize: uint32;
    uncompressedSize: uint32;
    fileNameLength: uint16;
    extraFieldLength: uint16;
    fileName: bytes &size=self.fileNameLength;
    extraField: bytes &size=self.extraFieldLength;
};

public type CentralDirectoryFileHeader = unit {
    signature: bytes &size=4;
    versionMadeBy: uint16;
    versionNeededToExtract: uint16;
    flags: uint16;
    compressionMethod: uint16;
    lastModFileTime: uint16;
    lastModFileDate: uint16;
    crc32: uint32;
    compressedSize: uint32;
    uncompressedSize: uint32;
    fileNameLength: uint16;
    extraFieldLength: uint16;
    fileCommentLength: uint16;
    diskNumberStart: uint16;
    internalFileAttributes: uint16;
    externalFileAttributes: uint32;
    relativeOffsetOfLocalHeader: uint32;
    fileName: bytes &size=self.fileNameLength;
    extraField: bytes &size=self.extraFieldLength;
    fileComment: bytes &size=self.fileCommentLength;
};

public type EndOfCentralDirectoryRecord = unit {
    signature: bytes &size=4;
    numberOfThisDisk: uint16;
    numberOfTheDiskWithTheStartOfTheCentralDirectory: uint16;
    totalNumberOfEntriesInTheCentralDirectoryOnThisDisk: uint16;
    totalNumberOfEntriesInTheCentralDirectory: uint16;
    sizeOfTheCentralDirectory: uint32;
    offsetOfStartOfCentralDirectoryWithRespectToTheStartingDiskNumber: uint32;
    zipFileCommentLength: uint16;
    zipFileComment: bytes &size=self.zipFileCommentLength;
};

public type ZIPFile = unit {
    files: LocalFileHeader[] &eod;
    centralDirectory: CentralDirectoryFileHeader[] &eod;
    endOfCentralDirectory: EndOfCentralDirectoryRecord;
};