module ICMP;

import spicy;

type ICMPHeader = unit {
    type: uint8;
    code: uint8;
    checksum: uint16;
    restOfHeader: bytes &size=4;

    on %init {
        if (self.type == 8) { // Echo (ping) request
            print "ICMP Echo Request Detected";
        }
        if (self.type == 0) { // Echo (ping) reply
            print "ICMP Echo Reply Detected";
        }
    }
};

public type ICMPMessage = unit {
    header: ICMPHeader;
    payload: bytes &eod;
};