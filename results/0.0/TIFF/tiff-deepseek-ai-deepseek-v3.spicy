module TIFF;

import spicy;

type TIFFHeader = unit {
    ByteOrder: bytes &size=2;
    Version: uint16;
    IFDOffset: uint32;
};

type IFDEntry = unit {
    Tag: uint16;
    Type: uint16;
    Count: uint32;
    ValueOffset: bytes &size=4;
};

type IFD = unit {
    NumEntries: uint16;
    Entries: IFDEntry[] &until($input.size() == 0);
    NextIFDOffset: uint32;
};

type TIFFFile = unit {
    Header: TIFFHeader;
    IFDs: IFD[] &until($input.size() == 0);
};

type ImageWidth = uint32;
type ImageLength = uint32;
type BitsPerSample = uint16;
type Compression = uint16;
type PhotometricInterpretation = uint16;
type Thresholding = uint16;
type CellWidth = uint16;
type CellLength = uint16;
type FillOrder = uint16;
type DocumentName = string;
type ImageDescription = string;
type Make = string;
type Model = string;
type StripOffsets = uint32[];
type Orientation = uint16;
type SamplesPerPixel = uint16;
type RowsPerStrip = uint32;
type StripByteCounts = uint32[];
type MinSampleValue = uint16;
type MaxSampleValue = uint16;
type XResolution = uint32;
type YResolution = uint32;
type PlanarConfiguration = uint16;
type PageName = string;
type XPosition = uint32;
type YPosition = uint32;
type FreeOffsets = uint32[];
type FreeByteCounts = uint32[];
type GrayResponseUnit = uint16;
type GrayResponseCurve = uint16[];
type T4Options = uint32;
type T6Options = uint32;
type ResolutionUnit = uint16;
type PageNumber = uint16[];
type TransferFunction = uint16[];
type Software = string;
type DateTime = string;
type Artist = string;
type HostComputer = string;
type Predictor = uint16;
type WhitePoint = uint32[];
type PrimaryChromaticities = uint32[];
type ColorMap = uint16[];
type HalftoneHints = uint16[];
type TileWidth = uint32;
type TileLength = uint32;
type TileOffsets = uint32[];
type TileByteCounts = uint32[];
type InkSet = uint16;
type InkNames = string;
type NumberOfInks = uint16;
type DotRange = uint16[];
type TargetPrinter = string;
type ExtraSamples = uint16;
type SampleFormat = uint16;
type SMinSampleValue = uint32;
type SMaxSampleValue = uint32;
type TransferRange = uint16[];
type JPEGTables = bytes;
type JPEGProc = uint16;
type JPEGInterchangeFormat = uint32;
type JPEGInterchangeFormatLength = uint32;
type JPEGRestartInterval = uint16;
type JPEGLosslessPredictors = uint16[];
type JPEGPointTransforms = uint16[];
type JPEGQTables = uint32[];
type JPEGDCTables = uint32[];
type JPEGACTables = uint32[];
type YCbCrCoefficients = uint32[];
type YCbCrSubSampling = uint16[];
type YCbCrPositioning = uint16;
type ReferenceBlackWhite = uint32[];

type TIFFImage = unit {
    ImageWidth: ImageWidth;
    ImageLength: ImageLength;
    BitsPerSample: BitsPerSample;
    Compression: Compression;
    PhotometricInterpretation: PhotometricInterpretation;
    Thresholding: Thresholding;
    CellWidth: CellWidth;
    CellLength: CellLength;
    FillOrder: FillOrder;
    DocumentName: DocumentName;
    ImageDescription: ImageDescription;
    Make: Make;
    Model: Model;
    StripOffsets: StripOffsets;
    Orientation: Orientation;
    SamplesPerPixel: SamplesPerPixel;
    RowsPerStrip: RowsPerStrip;
    StripByteCounts: StripByteCounts;
    MinSampleValue: MinSampleValue;
    MaxSampleValue: MaxSampleValue;
    XResolution: XResolution;
    YResolution: YResolution;
    PlanarConfiguration: PlanarConfiguration;
    PageName: PageName;
    XPosition: XPosition;
    YPosition: YPosition;
    FreeOffsets: FreeOffsets;
    FreeByteCounts: FreeByteCounts;
    GrayResponseUnit: GrayResponseUnit;
    GrayResponseCurve: GrayResponseCurve;
    T4Options: T4Options;
    T6Options: T6Options;
    ResolutionUnit: ResolutionUnit;
    PageNumber: PageNumber;
    TransferFunction: TransferFunction;
    Software: Software;
    DateTime: DateTime;
    Artist: Artist;
    HostComputer: HostComputer;
    Predictor: Predictor;
    WhitePoint: WhitePoint;
    PrimaryChromaticities: PrimaryChromaticities;
    ColorMap: ColorMap;
    HalftoneHints: HalftoneHints;
    TileWidth: TileWidth;
    TileLength: TileLength;
    TileOffsets: TileOffsets;
    TileByteCounts: TileByteCounts;
    InkSet: InkSet;
    InkNames: InkNames;
    NumberOfInks: NumberOfInks;
    DotRange: DotRange;
    TargetPrinter: TargetPrinter;
    ExtraSamples: ExtraSamples;
    SampleFormat: SampleFormat;
    SMinSampleValue: SMinSampleValue;
    SMaxSampleValue: SMaxSampleValue;
    TransferRange: TransferRange;
    JPEGTables: JPEGTables;
    JPEGProc: JPEGProc;
    JPEGInterchangeFormat: JPEGInterchangeFormat;
    JPEGInterchangeFormatLength: JPEGInterchangeFormatLength;
    JPEGRestartInterval: JPEGRestartInterval;
    JPEGLosslessPredictors: JPEGLosslessPredictors;
    JPEGPointTransforms: JPEGPointTransforms;
    JPEGQTables: JPEGQTables;
    JPEGDCTables: JPEGDCTables;
    JPEGACTables: JPEGACTables;
    YCbCrCoefficients: YCbCrCoefficients;
    YCbCrSubSampling: YCbCrSubSampling;
    YCbCrPositioning: YCbCrPositioning;
    ReferenceBlackWhite: ReferenceBlackWhite;
};

type TIFF = unit {
    Header: TIFFHeader;
    IFDs: IFD[];
    Images: TIFFImage[];
};